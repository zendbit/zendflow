{
  "appInfo": {
    "appName": "",
    "appType": "web",
    "appDesc": "create web app with zfcore."
  },
  "nimble": [
    "install zip@#head",
    "install uri3@#head",
    "install zfblast@#head",
    "install zfcore@#head",
    "install zfplugs@#head",
    "install stdext@#head",
    "install moustachu@#head",
    "install karax@#head"
  ],
  "initVar": {
    "appDir": "{appsDir}::{appName}",
    "srcDir": "{appDir}::src",
    "srcFrontendDir": "{appDir}::srcDir::frontend",
    "srcbackendDir": "{appDir}::srcDir::backend",
    "wwwDir": "{appDir}::www",
    "compiledJsDir": "{wwwDir}::private::js"
  },
  "init": [
    {
      "action": "copyDir",
      "list": [
        {
          "src": "{templatesDir}::{appType}",
          "dest": "{appDir}",
          "next":[
            {
              "action": "createDir",
              "list": [
                {"name": "{compiledJsDir}"}
              ]
            }
          ]
        }
      ]
    },
    {
      "action": "copyFile",
      "list": [
        {
          "src": "nakefile.nim",
          "dest": "{appDir}::nakefile.nim"
        }
      ]
    }
  ],
  "compile-debug-frontend": {
    "desc": "compile debug frontend app only.",
    "tasks": [
      {
        "action": "cmd",
        "exe" : "nim",
        "props": {
          "src": "{currentAppDir}::src::frontend::app.nim",
          "out": "{currentAppDir}::www::private::js::app.js"
        },
        "options": "js --out:{out} {src}"
      }
    ]
  },
  "compile-release-frontend": {
    "desc": "compile release frontend app only.",
    "tasks": [
      {
        "action": "cmd",
        "exe" : "nim",
        "props": {
          "src": "{currentAppDir}::src::frontend::app.nim",
          "out": "{currentAppDir}::www::private::js::app.js"
        },
        "options": "js -d:release --out:{out} {src}"
      }
    ]
  },
  "compile-release-backend": {
    "desc": "compile release backend app only",
    "tasks": [
      {
        "action": "cmd",
        "exe": "nim",
        "props": {
          "src": "{currentAppDir}::src::backend::app.nim",
          "out": "{currentAppDir}",
          "nimblePath": "{currentAppDir}::nimbledeps"
        },
        "options": "c -d:nimDebugDlOpen --NimblePath:{nimblePath} -d:ssl -d:zlib -d:release --threads:on --outdir:{out} {src}"
      }
    ]
  },
  "compile-debug-backend": {
    "desc": "compile debug backend app only",
    "tasks": [
      {
        "action": "cmd",
        "exe": "nim",
        "props": {
          "src": "{currentAppDir}::src::backend::app.nim",
          "out": "{currentAppDir}",
          "nimblePath": "{currentAppDir}::nimbledeps"
        },
        "options": "c -d:nimDebugDlOpen --NimblePath:{nimblePath} -d:ssl -d:zlib --threads:on --outdir:{out} {src}"
      }
    ]
  },
  "debug": {
    "desc": "debug the app.",
    "tasks": [
      {
        "action": "cmd",
        "exe": "nake",
        "options": "compile-debug-backend {appName}",
        "next": [
          {
            "action": "cmd",
            "exe" : "nake",
            "options": "compile-debug-frontend {appName}"
          }
        ]
      }
    ]
  },
  "debug-run": {
    "desc": "debug the app then run it.",
    "tasks": [
      {
        "action": "cmd",
        "exe": "nake",
        "options": "debug {appName}",
        "next": [
          {
            "action": "cmd",
            "exe": "{currentAppDir}::app {appName}",
            "onPlatform": {
              "windows": {
                "exe": "{currentAppDir}::app.exe {appName}"
              }
            }
          }
        ]
      }
    ]
  },
  "release": {
    "desc": "release the app.",
    "tasks": [
      {
        "action": "cmd",
        "exe": "nake",
        "options": "compile-release-backend {appName}",
        "next": [
          {
            "action": "cmd",
            "exe" : "nake",
            "options": "compile-release-frontend {appName}"
          }
        ]
      }
    ]
  },
  "release-run": {
    "desc": "release the app then run it.",
    "tasks": [
      {
        "action": "cmd",
        "exe": "nake",
        "options": "release {appName}",
        "next": [
          {
            "action": "cmd",
            "exe": "{currentAppDir}::app {appName}",
            "onPlatform": {
              "windows": {
                "exe": "{currentAppDir}::app.exe {appName}"
              }
            }
          }
        ]
      }
    ]
  },
  "watch-debug-run": {
    "desc": "watch changes in debug mode then run.",
    "tasks": [
      {
        "action": "cmd",
        "exe": "nake",
        "options": "debug {appName}",
        "next": [
          {
            "action": "cmd",
            "exe": "{currentAppDir}::app {appName} &",
            "onPlatform": {
              "windows": {
                "exe": "start {currentAppDir}::app.exe {appName}"
              }
            },
            "next": [
              {
                "action": "watch",
                "list": [
                  {
                    "dirs": ["{currentAppDir}::src::backend"],
                    "pattern": "(?=.*).+\\.nim",
                    "onModified": [
                      {
                        "action": "cmd",
                        "exe": "killall app {appName}",
                        "onPlatform": {
                          "windows": {
                            "exe": "taskkill /IM \"app.exe {appName}\" /F"
                          }
                        }
                      },
                      {
                        "action": "cmd",
                        "exe": "nake",
                        "options": "compile-debug-backend {appName}",
                        "next": [
                          {
                            "action": "cmd",
                            "exe": "{currentAppDir}::app {appName} &",
                            "onPlatform": {
                              "windows": {
                                "exe": "start {currentAppDir}::app.exe {appName}"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "dirs": ["{currentAppDir}::src::frontend"],
                    "pattern": "(?=.*).+\\.nim",
                    "onModified": [
                      {
                        "action": "cmd",
                        "exe": "nake",
                        "options": "compile-debug-frontend {appName}"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  "watch-release-run": {
    "desc": "watch changes in release mode then run.",
    "tasks": [
      {
        "action": "cmd",
        "exe": "nake",
        "options": "release {appName}",
        "next": [
          {
            "action": "cmd",
            "exe": "{currentAppDir}::app {appName} &",
            "onPlatform": {
              "windows": {
                "exe": "start {currentAppDir}::app.exe {appName}"
              }
            },
            "next": [
              {
                "action": "watch",
                "list": [
                  {
                    "dirs": ["{currentAppDir}::src::backend"],
                    "pattern": "(?=.*).+\\.nim",
                    "onModified": [
                      {
                        "action": "cmd",
                        "exe": "killall app {appName}",
                        "onPlatform": {
                          "windows": {
                            "exe": "taskkill /IM \"app.exe {appName}\" /F"
                          }
                        }
                      },
                      {
                        "action": "cmd",
                        "exe": "nake",
                        "options": "compile-release-backend {appName}",
                        "next": [
                          {
                            "action": "cmd",
                            "exe": "{currentAppDir}::app {appName} &",
                            "onPlatform": {
                              "windows": {
                                "exe": "start {currentAppDir}::app.exe {appName}"
                              }
                            }
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "dirs": ["{currentAppDir}::src::frontend"],
                    "pattern": "(?=.*).+\\.nim",
                    "onModified": [
                      {
                        "action": "cmd",
                        "exe": "nake",
                        "options": "compile-release-frontend {appName}"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  }
}
