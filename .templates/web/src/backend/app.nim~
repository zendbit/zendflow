##
##  zfcore web framework for nim language
##  This framework if free to use and to modify
##  License: BSD
##  Author: Amru Rosyada
##  Email: amru.rosyada@gmail.com
##  Git: https://github.com/zendbit
##

## import zfcore
import zfcore/server
#import example
import zfplugs/settings
import index

var jSettings {.threadvar.}: JsonNode

routes:
  staticDir "/"

  before:
    jSettings = jsonSettings()

  after:
    if not jSettings.isNil:
      let allowedOrigin = jSettings{"allowedOrigin"}
      if not allowedOrigin.isNil and
        request.url.getDomain in allowedOrigin.to(seq[string]):
          response.headers["Access-Control-Allow-Origin"] = request.url.getDomain
          response.headers["Access-Control-Allow-Credentials"] = "true"

emitServer()
